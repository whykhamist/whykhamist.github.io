import{_ as $}from"./_plugin-vue_export-helper-x3n3nnut.js";import{a as l,c as f,o as q,F as z,b as A,d as T,e as E,s as H,q as O,i as j,B as D,J as F}from"./index-2sZdn9Tb.js";const J={__name:"tPullToRefresh",props:{contain:{type:Boolean,default:!1},distance:{type:Number,default:96,validator:n=>n>0},offset:{type:Number,default:32,validator:n=>n>0},swipeAreaHeight:{type:Number,default:96}},emits:["refresh"],setup(n,{emit:M}){const v=n,C=M,p=l(!1),i=l(0),h=l(null),m=l(!1),L=l(!1),_=l(!1),b=l(!1),c=l({start:{x:0,y:0},end:{x:0,y:0}}),o=l({up:!1,down:!1,left:!1,right:!1}),u=l({x:0,y:0}),d=l({top:0,left:0}),B=new IntersectionObserver(e=>{_.value=e[0].isIntersecting}),r=f(()=>{var e;return((e=h.value)==null?void 0:e.parentElement)??null}),w=f(()=>{let e=i.value/v.distance;return e>1?1:e<0?0:e}),R=f(()=>{let e=v.distance+(m.value?v.offset:0);return Math.ceil(i.value<=0?0:i.value>e?e:i.value)}),k=f(()=>Math.round((w.value+Number.EPSILON)*100)*3.6),g=f(()=>!p.value&&L.value&&_.value&&b.value),y=f(()=>({x:"clientX",y:"clientY"})),S=e=>{var t=e;typeof e.targetTouches<"u"&&(t=e.targetTouches[0]),c.value.start.x=u.value.x=t.pageX,c.value.start.y=u.value.y=t.pageY,m.value=!0;let a=r.value.getBoundingClientRect(),s={y:Math.round(a.top),x:Math.round(a.left)};b.value=c.value.start.y>=s.y&&c.value.start.y<=s.y+v.swipeAreaHeight,d.value.top=window.scrollY||document.body.scrollTop,d.value.left=window.scrollX||document.body.scrollLeft},I=e=>{if(g.value){m.value=!1;var t=e;typeof e.changedTouches<"u"&&(t=e.changedTouches[0]),c.value.end.x=t[y.value.x],c.value.end.y=t[y.value.y],X()}else x()},X=()=>{w.value>=1?(p.value=!0,C("refresh",()=>x())):x()},N=e=>{let t=e.changedTouches[0],a=t[y.value.y]-c.value.start.y,s=window.scrollY||document.body.scrollTop;L.value=v.contain?r.value.scrollTop==0:s==0,g.value?i.value=a:(d.value.top=s,d.value.left=window.scrollX||document.body.scrollLeft),Y(t[y.value.x],t[y.value.y])},Y=(e,t)=>{o.value.right=o.value.down=o.value.left=o.value.up=!1,e>u.value.x&&(o.value.right=!0),t>u.value.y&&(o.value.down=!0),e<u.value.x&&(o.value.left=!0),t<u.value.y&&(o.value.up=!0),u.value.x=e,u.value.y=t},x=()=>{i.value=0,p.value=!1,o.value.right=o.value.down=o.value.left=o.value.up=!1,b.value=!1},P=e=>{g.value&&v.contain&&document.body.scrollTo(d.value.left,d.value.top)};return q(()=>{var e,t,a;B.observe(h.value),(e=r.value)==null||e.addEventListener("touchstart",S,!1),(t=r.value)==null||t.addEventListener("touchend",I,!1),(a=r.value)==null||a.addEventListener("touchmove",N,!1),["scroll","touchmove","mousewheel"].forEach(s=>{document.body.addEventListener(s,P)})}),z(()=>{var e,t,a;B.unobserve(h.value),(e=r.value)==null||e.removeEventListener("touchstart",S,!1),(t=r.value)==null||t.removeEventListener("touchend",I,!1),(a=r.value)==null||a.removeEventListener("touchmove",N,!1),["scroll","touchmove","mousewheel"].forEach(s=>{document.body.removeEventListener(s,P)})}),(e,t)=>{const a=A("TIcon");return T(),E(F,{to:"body",disabled:n.contain},[H("div",D({ref_key:"swiper",ref:h},e.$attrs,{class:["pointer-events-none left-1/2 z-[99999] flex aspect-square w-12 -translate-x-1/2 items-center justify-center rounded-full border border-foreground/10 bg-background text-foreground shadow shadow-foreground/25 transition-all duration-75 ease-linear",{fixed:!n.contain,absolute:n.contain}],style:{top:`${R.value}px`,opacity:w.value}}),[O(e.$slots,"default",{refreshing:p.value,rotation:k.value},()=>[p.value?(T(),E(a,{key:1,name:"motion_photos_on",class:"animate-spin"})):(T(),E(a,{key:0,name:"refresh",class:"iconRotation",style:j({"--tw-rotate":`${k.value}deg`})},null,8,["style"]))],!0)],16)],8,["disabled"])}}},V=$(J,[["__scopeId","data-v-df75eab7"]]);export{V as default};
