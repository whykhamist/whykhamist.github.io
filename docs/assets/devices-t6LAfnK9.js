import{a as i,c as T,n as U,w as m,o as A,F as C,d as P,e as S,f as B,R as E,S as O,q as R,h as q,A as N,_ as $}from"./index-X5AUvwv7.js";const z={__name:"devices",props:{pause:{type:Boolean,default:!1},constraints:{type:Object,default:()=>({})}},emits:["error"],setup(g,{emit:w}){const y=N(()=>$(()=>import("./wrapper-5GgYXc_J.js"),__vite__mapDeps([0,1,2,3]))),h=g,_=w,r=i(null),o=i(!1),t=i([]),d=i({}),l=i(null),s=i(null),u=i(!1),D=T(()=>({error:r.value,loading:o.value,devices:t.value,device:l.value,stream:s.value,prompting:u.value,reload:M,cycle:x,changeDevice:n,capabilities:d.value})),k=async()=>{try{if("mediaDevices"in navigator&&"getUserMedia"in navigator.mediaDevices){let e=await navigator.permissions.query({name:"camera"});if(e.state=="prompt"&&(u.value=!0),e.state!="granted"){let a=await navigator.mediaDevices.getUserMedia({audio:!1,video:!0});await c(a)}return!0}throw{code:"NotSupportedError",message:"Access to media devices are not suppported!"}}catch(e){return r.value=e,!1}finally{u.value=!1}},p=async()=>(await navigator.mediaDevices.enumerateDevices()).filter(({kind:e})=>e=="videoinput"),b=()=>{let e=0;if(t.value.length>0){for(let a=0;a<t.value.length;a++)t.value[a].getCapabilities().facingMode.indexOf("environment")>-1&&(e=a);n(t.value[e])}},x=()=>{let e=t.value.indexOf(l.value),a=t.value[e+1];n(a??t.value[0])},n=async e=>{try{o.value=!0,l.value=e,await I(e)}catch(a){r.value=a}finally{o.value=!1}},I=async e=>{await c(s.value),s.value=null,U(),s.value=await navigator.mediaDevices.getUserMedia({audio:!1,video:{deviceId:e.deviceId}});let[a]=s.value.getTracks();d.value=a.getCapabilities(),await a.applyConstraints({advanced:[{width:1366,height:768}]})},c=async e=>{if(e){let a=e.getTracks();for(const v of a)e.removeTrack(v),await v.stop()}},f=async()=>{for(const e of t.value){let a=await navigator.mediaDevices.getUserMedia({audio:!1,video:{deviceId:l.value.deviceId}});c(a)}await c(s.value),t.value=[],s.value=l.value=null},M=async()=>{await f(),t.value=await p(),n(t.value[0])};return m(()=>h.pause,e=>{e?c(s.value):n(l.value)}),m(r,e=>{_("error",{code:"NotAllowedError",message:e.message})}),A(async()=>{await k()&&(t.value=await p(),b())}),C(async()=>{await f()}),(e,a)=>(P(),S(q(y),null,{default:B(()=>[R(e.$slots,"default",O(E(D.value)))]),_:3}))}};export{z as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/wrapper-5GgYXc_J.js","assets/_plugin-vue_export-helper-x3n3nnut.js","assets/index-X5AUvwv7.js","assets/index-chxe96U4.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}